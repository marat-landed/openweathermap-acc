<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Исследование точности прогнозов погоды от OpenWeatherMap</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
	  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
	  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
	  <script>
      var firebaseConfig = {
		apiKey: "AIzaSyDZCBYYnoI8O9rWW_V9PhksdRppDWfSG4o", 
		//"AIzaSyCRgEIkz7-X52c3e3f4TgqMEBAMF8J6paA",
		//authDomain: "probe-web.firebaseapp.com",
		//https://probe-web-default-rtdb.europe-west1.firebasedatabase.app 
		//(https://probe-web-default-rtdb.firebaseio.com/)
		//projectId: "probe-web",
		//storageBucket: "probe-web.appspot.com",
		//messagingSenderId: "12639340602",
		//appId: "1:12639340602:web:8895af48f5ac447da90d03",
		databaseURL: "https://probe-23-02-2023-default-rtdb.europe-west1.firebasedatabase.app"
		//"https://probe-web-default-rtdb.europe-west1.firebasedatabase.app"
      };
	  
	  function writeUserData(userId, name) {
		const db = firebase.database();
		firebase.set(firebase.ref(db, 'users1/' + userId), {
		  username: name,
		 });
	  }

	  //writeUserData(1, "jacob");

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
	  
	  const path_name = ["temp/min", "temp/max", "pressure"];
	  for (var part_name_no=0; part_name_no < path_name.length; part_name_no++) {
	    var path = "frecast/" + path_name[part_name_no];
	    const dbRef = firebase.database().ref(path);
	    var forecast = dbRef.once('value').then((snapshot) => {
		  if (snapshot.exists()) {
		    return snapshot.val();
		  } else ;
	    });
	  
	    //forecast.then(console.log); // .then((value) => console.log(value))
	    forecast.then((value) => {
	    //console.log(value); // Array(3) [ "1677920403 72.00 50.00 39.00 61.00 83.00 89.00 72.00 78.00", "1677920412 71.00 50.00 39.00 61.00 83.00 89.00 72.00 78.00", "1677920502 67.00 53.00 38.00 60.00 78.00 69.00 62.00 74.00" ]
		//console.log(typeof value); // object
		//console.log(Object.keys(value)); // Array(3) [ "0", "1", "2" ] Ключи
	    //console.log(value.length); // 3
		  // Последний прогноз
		  console.log("Последний прогноз " + path);
	      console.log(value[value.length-1]); // 1677920502 67.00 53.00 38.00 60.00 78.00 69.00 62.00 74.00
		//var propertyValues = Object.values(value);
		//console.log(propertyValues); // Array(3) [ "1677920403 72.00 50.00 39.00 61.00 83.00 89.00 72.00 78.00", "1677920412 71.00 50.00 39.00 61.00 83.00 89.00 72.00 78.00", "1677920502 67.00 53.00 38.00 60.00 78.00 69.00 62.00 74.00" ]
		//console.log(propertyValues[propertyValues.length-1]); // 1677920502 67.00 53.00 38.00 60.00 78.00 69.00 62.00 74.00
	    }); // .then((value) => console.log(value))
	  }
	  
	  /*
	  async function getHumidityLastForecast(path) {
		const dbRef = firebase.database().ref(path);
		var forecast = await dbRef.once('value').then((snapshot) => {
		  if (snapshot.exists()) {
			return snapshot.val();
		  } else ;
	    });
	    return forecast;
	  }
	  //getHumidityLastForecast("forecast/humidity/0").then((value) => console.log(value));
	  
	  var res = true;
	  for (var i=0; i<8; i++) {
	    if (res) {
		  var path = "forecast/humidity/" + i.toString();
		  var forecast = getHumidityLastForecast(path);
		  console.log(forecast);
		  if (forecast != null) {
			forecast.then((value) => {
			  console.log(path);
			  console.log(value);
			})
		  } else {
			console.log("forecast = null");
			res = false;
		  }
		}
	  }
	  */
	  //var ref = firebase.database().ref().child('forecast/clouds/4');
      //ref.on('value', function(snap) {
		//document.getElementById("answer").innerHTML = snap.val();
		//console.log("getElementById");
		//console.log(snap.val());
	  //});	
	  
    </script>
      <h1>
	    <samp>Version 61</samp>
		<br />
        04-03-2023 Исследование точности прогнозов погоды от OpenWeatherMap
        <br />
		<small>
          <em>Библиотека www.gstatic.com/firebasejs/8.10.0/firebase-database.js</em>
        </small>
		Пробная версия
      </h1>
	  <hr>
      <label>Answer:<span id='answer'></span></label>
    </body>
</html>