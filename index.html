<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Исследование точности прогнозов погоды от OpenWeatherMap</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
	  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
	  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
	  <script>
      var firebaseConfig = {
		apiKey: "AIzaSyDZCBYYnoI8O9rWW_V9PhksdRppDWfSG4o", 
		//"AIzaSyCRgEIkz7-X52c3e3f4TgqMEBAMF8J6paA",
		//authDomain: "probe-web.firebaseapp.com",
		//https://probe-web-default-rtdb.europe-west1.firebasedatabase.app 
		//(https://probe-web-default-rtdb.firebaseio.com/)
		//projectId: "probe-web",
		//storageBucket: "probe-web.appspot.com",
		//messagingSenderId: "12639340602",
		//appId: "1:12639340602:web:8895af48f5ac447da90d03",
		databaseURL: "https://probe-23-02-2023-default-rtdb.europe-west1.firebasedatabase.app"
		//"https://probe-web-default-rtdb.europe-west1.firebasedatabase.app"
      };
	  
	  function writeUserData(userId, name) {
		const db = firebase.database();
		firebase.set(firebase.ref(db, 'users1/' + userId), {
		  username: name,
		 });
	  }

	  //writeUserData(1, "jacob");

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
	  
	  const dbRef = firebase.database().ref("forecast/humidity");
	  var forecast = dbRef.once('value').then((snapshot) => {
		if (snapshot.exists()) {
		  return snapshot.val();
		} else ;
	  });
	  //forecast.then(console.log); // .then((value) => console.log(value))
	  forecast.then((value) => {
	    console.log(value);
		console.log(typeof value);
	    console.log(value.length);
	    console.log(value[value.length]);
	  }); // .then((value) => console.log(value))
	  
	  async function getHumidityLastForecast(path) {
		const dbRef = firebase.database().ref(path);
		var forecast = await dbRef.once('value').then((snapshot) => {
		  if (snapshot.exists()) {
			return snapshot.val();
		  } else ;
	    });
	    return forecast;
	  }
	  //getHumidityLastForecast("forecast/humidity/0").then((value) => console.log(value));
	  
	  var res = true;
	  for (var i=0; i<8; i++) {
	    if (res) {
		  var path = "forecast/humidity/" + i.toString();
		  var forecast = getHumidityLastForecast(path);
		  if (forecast != null) {
			forecast.then((value) => {
			  console.log(path);
			  console.log(value);
			})
		  } else {
			console.log("forecast = null");
			res = false;
		  }
		}
	  }
	  
	  //var ref = firebase.database().ref().child('forecast/clouds/4');
      //ref.on('value', function(snap) {
		//document.getElementById("answer").innerHTML = snap.val();
		//console.log("getElementById");
		//console.log(snap.val());
	  //});	
	  
    </script>
      <h1>
	    <samp>Version 56</samp>
		<br />
        04-03-2023 Исследование точности прогнозов погоды от OpenWeatherMap
        <br />
		<small>
          <em>Библиотека www.gstatic.com/firebasejs/8.10.0/firebase-database.js</em>
        </small>
		Пробная версия
      </h1>
	  <hr>
      <label>Answer:<span id='answer'></span></label>
    </body>
</html>